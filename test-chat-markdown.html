<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat Markdown Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .message-text {
            line-height: 1.6;
            color: #333;
        }
        h2 {
            color: #667eea;
            margin-bottom: 15px;
        }
        .input-section {
            margin-top: 20px;
        }
        textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: inherit;
            min-height: 100px;
        }
        button {
            margin-top: 10px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover {
            background: #5568d3;
        }
        .output {
            margin-top: 20px;
            padding: 15px;
            background: #f9fafb;
            border-radius: 5px;
            border-left: 3px solid #667eea;
        }
    </style>
</head>
<body>
    <h1>ðŸ§ª Chat Markdown Test</h1>

    <div class="test-section">
        <h2>Test 1: Sample Chat Response</h2>
        <div class="message-text" id="test1"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Custom Input</h2>
        <div class="input-section">
            <textarea id="customInput" placeholder="Enter text with markdown:
**Bold text**
1. First item
2. Second item
- Bullet one
- Bullet two">This course covers essential teaching topics:

1. **Classroom Management** - Setting expectations and building relationships
2. **Lesson Planning** - Creating effective lessons
3. **Assessment Strategies** - Measuring student progress
4. **Educational Technology** - Using modern tools
5. **Curriculum Development** - Aligning with standards

Each section includes practical exercises and real-world examples.</textarea>
            <button onclick="testCustomInput()">Test Formatting</button>
        </div>
        <div class="output" id="output" style="display: none;">
            <strong>Formatted Output:</strong>
            <div class="message-text" id="customOutput"></div>
        </div>
    </div>

    <div class="test-section">
        <h2>Test 3: Edge Cases</h2>
        <div class="message-text" id="test3"></div>
    </div>

    <script>
        function formatMarkdown(text) {
            if (!text) return '';

            // Escape HTML first to prevent XSS
            const div = document.createElement('div');
            div.textContent = text;
            let html = div.innerHTML;

            // Convert markdown formatting to HTML (process in order)

            // 1. Bold: **text** -> <strong>text</strong>
            html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');

            // 2. Numbered lists: 1. item -> <ol><li>item</li></ol>
            html = html.replace(/^(\d+)\.\s+(.+)$/gm, '<li-num data-num="$1">$2</li-num>');

            // 3. Wrap consecutive numbered list items
            html = html.replace(/(<li-num[^>]*>.*?<\/li-num>\s*)+/g, (match) => {
                return '<ol style="margin: 10px 0; padding-left: 20px; list-style-position: inside;">' +
                       match.replace(/<li-num[^>]*>(.*?)<\/li-num>/g, '<li style="margin-bottom: 5px;">$1</li>') +
                       '</ol>';
            });

            // 4. Bullet lists: - item
            html = html.replace(/^[\-]\s+(.+)$/gm, '<li-bullet>$1</li-bullet>');

            // 5. Wrap consecutive bullet list items
            html = html.replace(/(<li-bullet>.*?<\/li-bullet>\s*)+/g, (match) => {
                return '<ul style="margin: 10px 0; padding-left: 20px; list-style-position: inside;">' +
                       match.replace(/<li-bullet>(.*?)<\/li-bullet>/g, '<li style="margin-bottom: 5px;">$1</li>') +
                       '</ul>';
            });

            // 6. Preserve line breaks
            html = html.replace(/\n/g, '<br>');

            return html;
        }

        // Test 1: Basic formatting
        const test1Text = `This course covers essential teaching topics:

1. **Classroom Management** - Setting expectations and building relationships
2. **Lesson Planning** - Creating effective lessons
3. **Assessment Strategies** - Measuring student progress
4. **Educational Technology** - Using modern tools
5. **Curriculum Development** - Aligning with standards

Each section includes practical exercises and real-world examples.`;

        document.getElementById('test1').innerHTML = formatMarkdown(test1Text);

        // Test 2: Custom input
        function testCustomInput() {
            const input = document.getElementById('customInput').value;
            const output = document.getElementById('customOutput');
            const container = document.getElementById('output');

            output.innerHTML = formatMarkdown(input);
            container.style.display = 'block';
        }

        // Test 3: Edge cases
        const test3Text = `Edge cases:

**Multiple** **bold** **words**
1. Item with **bold** inside
2. Item with - dash inside
- Bullet with **bold**
- Another bullet

Text with **bold in middle** of sentence.`;

        document.getElementById('test3').innerHTML = formatMarkdown(test3Text);

        // Auto-run custom input test
        testCustomInput();
    </script>
</body>
</html>
